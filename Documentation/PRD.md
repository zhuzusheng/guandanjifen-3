# 掼蛋记分小程序 - 产品需求文档 (PRD)

## 1. 项目背景 (Background)

### 问题/机遇
掼蛋作为一种流行的桌面游戏，在朋友聚会和娱乐场所广受欢迎。然而，传统的纸笔记分方式存在诸多痛点：
- 记分容易出错，计算繁琐
- 纸质记录容易丢失，无法长期保存
- 无法实时查看积分变化和历史记录
- 多局游戏的统计汇总困难

本产品旨在通过微信小程序的便捷性，为掼蛋爱好者提供一个简单、准确、可追溯的数字化记分解决方案。

### 用户画像
- **核心用户群体**：掼蛋游戏爱好者，年龄25-50岁
- **使用场景**：朋友聚会、家庭娱乐、棋牌室等需要多局记分的场合
- **技术特征**：熟悉微信生态，对小程序操作有一定了解
- **需求特点**：重视操作简便性、数据准确性和记录可查性

## 2. 产品目标 (Objectives)

### 核心目标
- 提供简单易用的掼蛋记分工具，减少记分错误率至0
- 实现房间管理和多人协作记分，提升游戏体验
- 建立完整的积分记录体系，支持历史数据查询

### 项目范围与平台
- **部署平台**：微信小程序
- **数据持久化**：用户的所有游戏记录都应被安全保存，确保用户在不同时间、不同设备（通过同一微信账号登录）访问时数据的一致性和可追溯性。

### 关联文档
本PRD的核心业务流程，请参考独立的《产品流程图》文档。

## 3. 功能列表 (Feature List)

- **页面一：用户授权登录页**
- **页面二：首页（功能导航）**
- **页面三：创建房间页**
- **页面四：扫码加入页**
- **页面五：房间等待页**
- **弹窗六：邀请好友弹窗**
- **页面七：游戏记分页**
- **弹窗八：记分操作弹窗**
- **弹窗九：通用确认弹窗 (如：解散/退出房间)**
- **页面十：历史记录列表页**
- **页面十一：房间详情页**

## 4. 功能详述 (Feature Details)

### 页面一：用户授权登录页

#### 功能用途 (Purpose)
作为小程序的入口页面，建立用户身份认证体系，获取必要的用户信息（昵称、头像），为后续的房间创建、记分等功能提供身份基础。

#### 核心功能 (Core Functions)
- **微信登录授权**：用户首次进入小程序时，显示授权引导界面，用户点击确认进行微信授权登录。
- **获取用户信息**：授权成功后自动获取用户微信昵称和头像，用于在房间中的用户识别。
- **授权状态检查**：每次进入小程序时检查授权状态，已授权用户直接跳转到首页。

### 页面二：首页（功能导航）

#### 功能用途 (Purpose)
作为小程序的主要功能导航中心，为用户提供快速访问创建房间、加入房间、查看历史记录等核心功能的入口。

#### 核心功能 (Core Functions)
- **用户信息显示**：在页面顶部显示当前用户的头像和昵称。
- **创建房间入口**：提供"创建房间"按钮，点击跳转到【创建房间页】。
- **加入房间入口**：提供"扫码加入"按钮，点击跳转到【扫码加入页】。
- **历史记录入口**：提供"历史记录"按钮，点击跳转到【历史记录列表页】。

### 页面三：创建房间页

#### 功能用途 (Purpose)
为用户提供创建新游戏房间的功能，包括设置记分档位等个性化配置，生成房间后成为房间创建者。

#### 核心功能 (Core Functions)
- **记分档位设置**:
  - 系统默认提供10、20、30三个分值选项。
  - 支持用户自定义修改分值选项（用于记分时的快捷选择）。
  - 分值设置完成后不可在游戏过程中修改。
- **房间创建确认**：点击"创建房间"按钮后生成唯一房间标识。
- **自动跳转**：房间创建成功后自动跳转到【房间等待页】。

### 页面四：扫码加入页

#### 功能用途 (Purpose)
为用户提供通过扫描二维码加入已有房间的功能。

#### 核心功能 (Core Functions)
- **调用扫码**: 触发微信扫码功能，识别房间二维码。
- **验证与加入**: 系统后台自动验证二维码的有效性，包括：
    - 邀请码是否在有效期内。
    - 房间是否还有空位（未满4人）。
    - 房间是否处于可加入状态（游戏未开始）。
- **结果反馈**: 
    - **成功**: 自动跳转到对应房间的【房间等待页】。
    - **失败**: 在当前页提示具体的错误信息（如：邀请码已过期、房间已满、房间不存在等）。

### 页面五：房间等待页

#### 功能用途 (Purpose)
作为房间的准备阶段界面，显示当前房间成员信息，提供邀请分享功能，管理游戏开始前的各项准备工作。

#### 核心功能 (Core Functions)
- **成员信息显示**:
  - 显示当前房间内所有成员的头像和昵称。
  - 标识房间创建者身份。
  - 实时更新成员变化（加入/退出）。
- **发起邀请**: 人数不足4人时，房主可点击"邀请好友"按钮，弹出【邀请好友弹窗】。
- **游戏开始控制**:
  - 仅房间创建者在4人齐全时可以点击"开始游戏"。
  - 人数不足时"开始游戏"按钮置灰不可点击。
- **退出房间**: 任何用户都可以点击"退出房间"按钮，弹出【通用确认弹窗】，二次确认后离开房间。

### 弹窗六：邀请好友弹窗

#### 功能用途 (Purpose)
以二维码的形式分享房间，方便其他用户扫码加入。

#### 核心功能 (Core Functions)
- **二维码展示**: 清晰展示一个包含房间信息的二维码。
- **有效性提示**: 二维码下方需注明其有效时间（例如：10分钟内有效）。
- **刷新机制**: 
  - 邀请码到期后，二维码将自动失效，用户需要求房主重新分享。
  - 提供"刷新"按钮，允许房主在有效期内手动生成新的二维码。

### 页面七：游戏记分页

#### 功能用途 (Purpose)
提供核心的记分功能，实时显示所有玩家的积分状态，支持用户间的输赢记录，确保记分的准确性和实时性。

#### 核心功能 (Core Functions)
- **积分面板显示**:
  - 以4宫格或列表形式显示所有玩家头像、昵称和当前积分。
  - 初始积分均为0，实时更新积分变化。
  - 积分支持正负数显示。
- **发起记分**: 用户点击任意玩家头像（包括自己），弹出【记分操作弹窗】，其中被点击的一方默认为"赢家"。
- **游戏管理功能**:
  - **解散房间（房主）**: 房主可点击"解散房间"，弹出【通用确认弹窗】，确认后解散。
  - **退出房间（成员）**: 成员可点击"退出房间"，弹出【通用确认弹窗】，确认后退出。
  - **退出逻辑**: 如果退出的是房主，则房间自动解散并通知所有成员。
- **状态处理**:
  - 人数不足4人时无法进行记分操作。
  - 显示当前房间状态和人数信息。

### 弹窗八：记分操作弹窗

#### 功能用途 (Purpose)
为单次游戏操作提供清晰的记分界面，明确指定赢家、输家和分值。

#### 核心功能 (Core Functions)
- **赢家信息**: 弹窗顶部明确标识本次记分的"赢家"（即用户在【游戏记分页】上点击的玩家）。
- **输家选择**:
  - 以列表或按钮形式，展示除赢家外的其他三位玩家。
  - 用户需点选一位玩家作为"输家"。
- **分值选择**:
  - 展示在【创建房间页】设定的分值档位（如10, 20, 30）。
  - 用户需选择一个分值。
- **确认记分**: 点击"确认"按钮后，系统自动执行计分逻辑：
    - 输家积分 - 所选分值。
    - 赢家积分 + 所选分值。
    - 计分完成后，弹窗关闭，【游戏记分页】的积分面板实时刷新。
- **取消操作**: 提供关闭或取消按钮，不执行任何操作并关闭弹窗。

### 弹窗九：通用确认弹窗 (如：解散/退出房间)

#### 功能用途 (Purpose)
用于关键操作的二次确认，防止用户误操作导致游戏中断或数据丢失。

#### 核心功能 (Core Functions)
- **信息提示**: 弹窗中间清晰地展示需要用户确认的操作内容，如"您确定要解散本房间吗？"或"您确定要退出房间吗？"
- **操作按钮**:
  - **确认按钮**: （如"确定解散"），点击后执行相应操作。
  - **取消按钮**: 点击后关闭弹窗，不执行任何操作。

### 页面十：历史记录列表页

#### 功能用途 (Purpose)
为用户提供个人游戏历史的总览，展示曾经参与过的所有房间记录，支持快速查看和筛选。

#### 核心功能 (Core Functions)
- **历史房间列表**:
  - 显示用户曾加入且已开始过的所有房间。
  - 列表按房间开始时间倒序排列（最新的在最上面）。
  - 每个房间显示：房间创建人、游戏开始时间、参与人员头像。
- **房间状态标识**:
  - 区分已结束和进行中的房间。
  - 显示房间基本统计信息（如总局数、个人积分等）。
- **快速访问**:
  - 点击任意房间条目可跳转到对应的【房间详情页】。
  - 支持长列表滚动加载（如果房间数量较多）。

### 页面十一：房间详情页

#### 功能用途 (Purpose)
为用户提供特定房间的完整游戏记录，包括详细的积分统计和每次记分的明细信息，支持完整的游戏回顾。

#### 核心功能 (Core Functions)
- **房间基本信息**:
  - 显示房间创建人、游戏开始时间。
  - 显示房间记分档位设置。
  - 显示房间当前状态（进行中/已结束）。
- **积分统计面板**:
  - 显示房间内每个用户的总积分。
  - 支持积分排行显示（从高到低）。
  - 显示每个用户的胜负统计。
- **记分明细列表**:
  - 显示所有记分记录，按时间倒序排列。
  - 每条记录包含：操作时间、败者、获胜者、分值变化。
- **分享战绩**: 提供"分享战绩"按钮，点击后可生成一张包含最终积分排行的图片，用户可保存或分享给好友。
- **导航**: 提供返回【历史记录列表页】的按钮。 